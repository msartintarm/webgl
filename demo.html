<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN'
	  'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>
<!-- All text on this page is property of Aberger / Sartin-Tarm. (c) 2013. -->
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <meta http-equiv='Content-Type' content='text/html charset=utf-8'/>
    <title>WebGL Demo</title>
    <link rel='stylesheet' type='text/css' href='styles.css'/>
    <link rel='icon' type='image/x-icon' href='./favicon.ico'/>

    <!-- External JS math libraries -->
    <script src="libs/gl-matrix.js" type="text/javascript"></script> 
    <script src="libs/webgl-utils.js" type="text/javascript"></script>

    <!-- Global constants and functions -->
    <script src="functions.js" type="text/javascript"></script>
    <script src="constants.js" type="text/javascript"></script>

    <!-- GL classes -->
    <script src="GLobject.js" type="text/javascript"></script>
    <script src="GLmatrix.js" type="text/javascript"></script>
    <script src="GLtexture.js" type="text/javascript"></script>
    <script src="GLframe.js" type="text/javascript"></script>
    <script src="GLcanvas.js" type="text/javascript"></script>

    <!-- Simple objects -->
    <script src="Cylinder.js" type="text/javascript"></script>
    <script src="Sphere.js" type="text/javascript"></script>
    <script src="Torus.js" type="text/javascript"></script>
    <script src="Disk.js" type="text/javascript"></script>
    <script src="Quad.js" type="text/javascript"></script>

    <!-- Complex objects lv.1 -->
    <script src="Stool.js" type="text/javascript"></script>
    <script src="Light.js" type="text/javascript"></script>
    <script src="SixSidedPrism.js" type="text/javascript"></script>
    <script src="Ball.js" type="text/javascript"></script>
    <script src="ThickCyl.js" type="text/javascript"></script>
    
    <!-- Complex objects lv.2 -->
    <script src="StoolPyramid.js" type="text/javascript"></script>
    <script src="MazePiece.js" type="text/javascript"></script>
    <script src="StadiumPiece.js" type="text/javascript"></script>
    <script src="Jumbotron.js" type="text/javascript"></script>

    <!-- Environments -->
    <script src="Skybox.js" type="text/javascript"></script>
    <script src="Maze.js" type="text/javascript"></script>
    <script src="Stadium.js" type="text/javascript"></script>
    <script src="Cagebox.js" type="text/javascript"></script>

    <canvas id="textureCanvas" style="display:none;">
      I'm sorry your browser does not support the HTML5 canvas element.
    </canvas>

    <script id="shader-fs" type="x-shader/x-fragment">
precision mediump float;

varying float diffuseV;
varying float specularV;
varying float textureNumV;
varying vec3 colorV;

varying vec3 reflectionV;
varying vec3 viewPosV;
varying vec3 vModel;
varying vec4 lModel;
varying vec3 lightNorm;
varying vec3 vertNorm;

varying vec2 textureV;
varying vec2 shadowV;

uniform sampler2D sampler0;
uniform sampler2D sampler1;
uniform sampler2D sampler2;
uniform sampler2D sampler3;
uniform sampler2D sampler4;
uniform sampler2D sampler5;
uniform sampler2D sampler6;
uniform sampler2D sampler7;
uniform sampler2D sampler8;
uniform sampler2D sampler9;
uniform sampler2D sampler10;
uniform sampler2D sampler11;
uniform sampler2D sampler12;
uniform sampler2D sampler13;
uniform sampler2D sampler14;
uniform sampler2D sampler15;
uniform sampler2D sampler16;
uniform sampler2D sampler17;

  // Specular

float specular() {
    vec3 reflectionV2 = (normalize(vertNorm) * diffuseV *
		 2.0) - lightNorm;
    vec3 viewer = vec3(0.,0.,0.);
float specularV2 = dot(normalize(reflectionV2), 
                    normalize(viewer - vModel.xyz));
    if (specularV2 <= 0. || diffuseV <= 0.) { specularV2 = 0.0; }
    specularV2 = specularV2 * specularV2;
    specularV2 = specularV2 * specularV2;
    specularV2 = specularV2 * specularV2;
    specularV2 = specularV2 * specularV2;
    return specularV2;
}

void colorize() {
  float ambConst = 0.1;
  float diffConst = 0.7;
  vec3 ambColor = colorV / 3.0 * ambConst;
  vec3 diffColor = colorV / 3.0 * diffuseV * diffConst;
  vec3 specColor = vec3(.8, .8, .8) * specular();
  gl_FragColor = vec4(ambColor + diffColor + specColor, 1.0);
}

void texturize(sampler2D theSampler,
              float diffConst,
              float ambConst,
              vec3 specColor) {
  vec3 textureColor = texture2D(theSampler, 
    vec2(textureV.s, textureV.t)).xyz;
  vec3 ambColor = textureColor / 3.0 * ambConst;
  vec3 diffColor = textureColor / 3.0 * diffuseV * diffConst;

  gl_FragColor = vec4(ambColor + diffColor + specColor, 1.0);
}

void colorTexture(sampler2D theSampler,
                  float ambConst,
                  float diffConst) {
  vec3 textureColor = texture2D(theSampler, vec2(textureV.s, textureV.t)).xyz;
  vec3 ambColor = textureColor / 3.0 * ambConst;
  vec3 diffColor = textureColor * diffuseV * diffConst;
  vec3 specColor = textureColor * specular();

  gl_FragColor = vec4(ambColor + diffColor + specColor, 1.0);
}

void colorSpecular(sampler2D theSampler,
                  float ambConst,
                  float diffConst,
                  vec3 specVec) {
  vec3 textureColor = texture2D(theSampler, 
    vec2(textureV.s, textureV.t)).xyz;
  vec3 ambColor = textureColor / 3.0 * ambConst;
  vec3 diffColor = textureColor * diffuseV * diffConst;
  vec3 specColor = textureColor * specVec;

  gl_FragColor = vec4(ambColor + diffColor + specColor, 1.0);
}

void colorNoLighting(sampler2D theSampler) {
  vec3 textureColor = texture2D(theSampler, 
    vec2(textureV.s, textureV.t)).xyz;

  gl_FragColor = vec4(textureColor, 1.0);
}

void main(void) {

if (textureNumV < 0.1) {colorTexture(sampler0, 0.1, 0.7);
} else if (textureNumV < 1.1) { colorTexture(sampler1, 0.1, 0.7);
} else if (textureNumV < 2.1) { colorSpecular(sampler2, 0.25, 0.7, vec3(.7,.2,.2) * specular());
} else if (textureNumV < 3.1) { colorTexture(sampler3, 0.2, 0.4);
} else if (textureNumV < 5.1) { colorTexture(sampler5, 0.1, 0.4);
} else if (textureNumV < 6.1) { colorTexture(sampler6, 0.25, 0.4);
} else if (textureNumV < 7.1) { colorize();

} else if (textureNumV < 13.1) { // skybox

   if (textureNumV < 8.1) { colorNoLighting(sampler8);
  } else if (textureNumV < 9.1) { colorNoLighting(sampler9);
  } else if (textureNumV < 10.1) { colorNoLighting(sampler10);
  } else if (textureNumV < 11.1) { colorNoLighting(sampler11);
  } else if (textureNumV < 12.1) { colorNoLighting(sampler12);
  } else { colorNoLighting(sampler13); }
} else if (textureNumV < 14.1) { colorSpecular(sampler14, 0.9, 0.7, vec3(.8,.8,.8) * specular());
} else if (textureNumV < 15.1) { colorNoLighting(sampler15);
} else if (textureNumV < 16.1) { colorTexture(sampler16, 0.3, 0.7);
} else { colorNoLighting(sampler17);
}
}
    </script>
    <script id="shader-vs" type="x-shader/x-vertex">
precision mediump float;

// Vector Attributes
attribute vec3 vPosA;
attribute vec3 vNormA;
attribute vec3 vColA;
attribute vec2 textureA;
attribute float textureNumA;

// Matrixes
uniform mat4 pMatU; // Position
uniform mat4 mMatU; // Model
uniform mat4 vMatU; // View
uniform mat4 nMatU; // Normal
uniform mat4 lMatU; // Lighting

// Position attributes
uniform vec3 lightPosU;
uniform vec3 viewPosU;

// Passed to the fragment shader
varying float diffuseV;
varying float textureNumV;
varying vec3 colorV;
varying vec2 textureV;
varying vec2 shadowV;

varying vec3 viewPosV;
varying vec3 vModel;
varying vec4 lModel;
varying vec3 lightNorm;
varying vec3 vertNorm;

void main(void) {

textureNumV = textureNumA;

// Viewing space coordinates of light / vertex
vModel = (vMatU * mMatU  * vec4(vPosA, 1.0)).xyz;
lModel = vMatU * lMatU * vec4(lightPosU, 1.0);

  // -- Position -- //

  gl_Position = pMatU * vMatU * mMatU * vec4(vPosA, 1.0);

  // -- Lighting -- //

  // Ambient components we'll leave until frag shader
  colorV = vColA;
  textureV = textureA;

  // Diffuse component
  lightNorm = normalize(lModel.xyz - vModel.xyz);

  vertNorm = normalize((nMatU * vec4(vNormA,1.0)).xyz);
  diffuseV = dot(vertNorm, lightNorm);
  if (diffuseV < 0.0) { diffuseV = 0.0; }
}       
    </script>
  </head>

  <body onload="theCanvas = new GLcanvas();">
    <div id='wrap'>
      <div id='header'>
        <div class='one_third'>WebGL:</div>
        <div class='one_third'>A</div>
        <div class='one_third'>Demo</div>
      </div>

      <div class="padDiv"> 
	<div id="banner">       
	  <div style="height:50px;">
	    <input id="inputz" type="text"
		   onclick="theCanvas.initText(document.getElementById('inputz').value);" 
		   value="Cylinder"/>
	    <input type="submit" 
		   onclick="theCanvas.initText(document.getElementById('inputz').value);" 
		   value="Submit"/>

</div>
	  <div class="lowAcross" ></div>
          <div class="topAcross" ></div>
          <div class="leftSide" ></div>
          <div class="rightSide" ></div>
          <div class="topLeft" ></div>
          <div class="topRight" ></div>
	  <div class="lowLeft" ></div>
          <div class="lowRight" ></div>


	  <div id="dashboard" style="padding: 20px; background-color: #000000;">
	    <div id="positionXStats" style="display:none;"></div>
	    <div id="positionYStats" style="display:none;"></div>
	    <div id="rotateStats" style="display:none;"></div>
	    <div id="rotateCamStats" style="display:none;"></div>
	    <div id="priveledgedStats" 
		 onclick="priveledgedMode.toggle()" 
		 style="display:none;"></div>
<!--	    <div id="priveledgedStats" style="display:none;"></div>-->
	    <div id="positionCheckStats" style="display:none;"></div>
	    <div id="frameDebug" style="display:none;"></div>
	  </div>
	</div>

	  <div id="keyboard" style="position:absolute; bottom: 0px; left: 0px; color: #ffffff;"></div>
        <div class='main'>
          <div class="border lowAcross" ></div>
          <div class="border topAcross" ></div>
          <div class="border leftSide" ></div>
          <div class="border rightSide" ></div>
          <div class="border topLeft" ></div>
          <div class="border topRight" ></div>
	  <div class="border lowLeft" ></div>
          <div class="border lowRight" ></div>
            <canvas id="glcanvas" width="1100">
			Your browser doesn't appear to support the HTML5 
			<code>&lt;canvas&gt;</code> element.
	    </canvas>
          <div class="title" id="title2">            
	    <!-- 
		 We use a table with 2x2 cells, 
		 lumping all the links into their own cells..
	      -->
	    <table style="width:100%;">
	    <thead><tr>
		<th><u>Shapes</u></th>
		<th><u>Environments</u></th>
	    </tr></thead>
	    <tbody><tr>
		<td>
		  <input type="button" 
			 onclick="theCanvas.start('cylinder');" 
			 value="Cylinder" 
			 class="button_add"/>
		  <input type="button" 
			 onclick="theCanvas.start('framebuffer');" 
			 value="Framebuffer" 
			 class="button_add"/>
		  <input type="button" 
			 onclick="theCanvas.start('skybox');" 
			 value="Skybox" 
			 class="button_add"/>
		  <input type="button" 
			 onclick="theCanvas.start('sphere');" 
			 value="Sphere" 
			 class="button_add"/>
		  <input type="button" 
			 onclick="theCanvas.start('stool');" 
			 value="Stool" 
			 class="button_add"/>
		  <input type="button" 
			 onclick="theCanvas.start('text');" 
			 value="Text" 
			 class="button_add"/>
		  <input type="button" 
			 onclick="theCanvas.start('torus');" 
			 value="Torus" 
			 class="button_add"/>
		</td>
		<td>
		  <input type="button" 
			 onclick="theCanvas.start('maze');" 
			 value="Maze" 
			 class="button_add"/>
		  <br/>
		  <input type="button" 
			 onclick="theCanvas.start('shadow');" 
			 value="Shadows" 
			 class="button_add"/>
		  <input type="button" 
			 onclick="theCanvas.start('jumbotron');" 
			 value="Jumbotron" 
			 class="button_add"/>
		  <input type="button" 
			 onclick="theCanvas.start('stadium');" 
			 value="Stadium" 
			 class="button_add"/>
		</td>
	    </tr></tbody>
	    </table>
          </div>
          <div id="webgl_settings_button" class="content">
	    <input type="button"
		   onclick="expand('settings')" 
		   value="Change settings!" 
		   class="button_add" />
          </div>       
		  
          <div id="settings" class="content">
              Privledge Mode:<br/>
              <input type="button" onclick="priveledgedMode.toggle()" value="toggle"/>
              <br/>Debug Statistics:<br/>
              <input type="button" 
		     onclick="mazeDebug = !mazeDebug;" 
		     value="Maze Bound Checking"/>
              <br/>Zoom:<br/>
              <input type="button" onclick="zoom.setIncZoom(-.2)" value="in"/>
              <input type="button" onclick="zoom.setIncZoom(.2)" value="out"/>
              <br/>Adjust Stool Height:<br/>
              <input type="button" onclick="stoolHeight.setStoolHeight(0.1)" value="up"/>
              <input type="button" onclick="stoolHeight.setStoolHeight(-0.1)" value="down"/>
              <br/>Select Shading:<br/>
              <input type="button" value="ADS model"
onclick="theCanvas.changeShaders('shader-fs', 'shader-vs')"/>
              <input type="button" value="Flat shading"
onclick="FLATNORMS = !FLATNORMS; theCanvas.changeShaders('shader-fs', 'shader-vs');"/>
              <input type="button" value="Depth shading"
onclick="theCanvas.changeShaders('frag-shader-shadow', 'vertex-shader-shadow')"/>
              <input type="button" value="Bad shader" 
onclick="theCanvas.changeShaders('shader-fs', 'vertex-shader-bad')"/>

          </div>        
	</div>
      </div>
    </div>
      
    <div id="footer"> 
      <input type="button" 
	     onclick="expand('content4')" 
	     value="(c) 2013 Batman and Robin" 
	     class="button_add" />
      <div id="content4" class="content">
	A noob
	
      </div>
      <div class="title" id="title4" > </div>            
      
    </div>
    
</div>
</body>
</html>
